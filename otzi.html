<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ötzi — La sagaie dans les glaces (version classe)</title>
<style>
  html,body{margin:0;height:100%;background:#0f1419;color:#e8eef6;
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{display:flex;flex-direction:column;align-items:center;gap:10px;padding:16px}
  canvas{background:#b7dcff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.35);
  width:960px;height:540px}
  .hud{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;
  font-weight:600}
  .kbd{padding:2px 6px;border-radius:6px;background:#223049;
  font-family:ui-monospace,Menlo,Consolas,monospace}
  button{padding:8px 12px;border-radius:10px;border:0;background:#1f6feb;
  color:#fff;font-weight:700;cursor:pointer}
  button.secondary{background:#2b3950}
  .pill{padding:3px 8px;border-radius:999px;background:#0b5;color:#fff;font-weight:700;font-size:12px}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.65);z-index:10}
  .overlay.show{display:flex}
  .card{max-width:760px;background:#161e27;padding:22px;border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.5)}
  h1,h2{margin:0 0 10px}
  .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
  background:#1f2530;color:#fff;padding:10px 14px;border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.4);font-weight:600;display:none;z-index:15}
  .toast.show{display:block}
</style>
</head>

<body>
<div class="wrap">
  <h1>Ötzi — La sagaie dans les glaces</h1>
  <div class="hud">
    <span>Niveau: <b id="levelName">—</b></span>
    <span>Temps: <b id="time">—</b>s</span>
    <span>Nourriture: <b id="meat">0</b></span>
    <span>Peaux: <b id="hides">0</b></span>
    <span>Pierre: <b id="stone">0</b></span>
    <span>Bois: <b id="wood">0</b></span>
    <span>Fibres: <b id="fiber">0</b></span>
    <span>Sagaies: <b id="spears">50</b></span>
    <span>Vies: <b id="lives">3</b></span>
    <button id="btnStart">Lancer / Rejouer</button>
    <button id="btnPause" class="secondary">Pause</button>
  </div>
  <div>Commandes : <span class="kbd">← → ↑ ↓</span> / <span class="kbd">Z Q S D</span> • <span class="kbd">Espace</span>/<span class="kbd">J</span> lancer une sagaie • <span class="kbd">R</span> tailler des sagaies • <span class="kbd">C</span> vêtements • <span class="kbd">Entrée</span> continuer.</div>
  <canvas id="game" width="960" height="540"></canvas>
  <div style="max-width:960px;text-align:center">
    Étapes : <span class="pill">1. Chasse</span> → <span class="pill">2. Élevage</span> → <span class="pill">3. Artisanat</span>
  </div>
</div>

<div id="overlay" class="overlay">
  <div class="card">
    <h2>Avant le niveau 1 — Chasse dans les glaces</h2>
    <p>Tu es Ötzi. L’hiver est rude. Tu disposes de <b>50 sagaies</b> pour t’entraîner à chasser.</p>
    <p>Objectifs : <b>2 viandes</b>, <b>2 pierres</b>, <b>2 bois</b> et <b>des vêtements</b> (2 peaux + 2 fibres).</p>
    <p>Contrôles : ZQSD/flèches pour bouger, Espace ou J pour lancer une sagaie, C pour vêtements, R pour tailler des sagaies.</p>
    <button id="btnContinue">Commencer (Entrée)</button>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
const ui={levelName:gameElem('levelName'),time:gameElem('time'),
meat:gameElem('meat'),hides:gameElem('hides'),stone:gameElem('stone'),
wood:gameElem('wood'),fiber:gameElem('fiber'),spears:gameElem('spears'),
lives:gameElem('lives')};
function gameElem(id){return document.getElementById(id);}
const overlay=document.getElementById('overlay');
const btnStart=document.getElementById('btnStart'),btnPause=document.getElementById('btnPause'),
btnContinue=document.getElementById('btnContinue'),toastEl=document.getElementById('toast');
function toast(msg,ms=1500){toastEl.textContent=msg;toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),ms);}

function rr(x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);
ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);ctx.closePath();}

function drawBG(){ctx.fillStyle='#b7dcff';ctx.fillRect(0,0,canvas.width,220);
ctx.fillStyle='#89c589';ctx.fillRect(0,240,canvas.width,canvas.height-240);
ctx.fillStyle='#7495b8';ctx.fillRect(0,220,canvas.width,20);}

let running=false,last=performance.now(),keys=new Set();
let time=0,player,spears=[],herd=[],pickups=[],res={};
let lvl=0;
function HUD(){ui.time.textContent=Math.max(0,Math.ceil(time));
ui.meat.textContent=res.meat;ui.hides.textContent=player.hides;
ui.stone.textContent=res.stone;ui.wood.textContent=res.wood;
ui.fiber.textContent=res.fiber;ui.spears.textContent=player.spears;}

class Player{constructor(){this.x=120;this.y=440;this.r=16;this.vx=0;this.vy=0;this.s=2.2;
this.spears=50;this.reload=0;this.hides=0;this.warm=false;}
rect(){return{x:this.x-16,y:this.y-16,w:32,h:32};}
update(dt){this.x=Math.max(16,Math.min(canvas.width-16,this.x+this.vx*this.s*dt));
this.y=Math.max(220,Math.min(canvas.height-16,this.y+this.vy*this.s*dt));
this.reload=Math.max(0,this.reload-dt);}
draw(){ctx.save();ctx.translate(this.x,this.y);
ctx.globalAlpha=.25;ctx.beginPath();ctx.ellipse(0,this.r,this.r*.9,this.r*.4,0,0,6.283);
ctx.fillStyle='#1b2a3b';ctx.fill();ctx.globalAlpha=1;
ctx.beginPath();ctx.moveTo(0,-this.r);ctx.lineTo(this.r*.9,this.r);ctx.lineTo(-this.r*.9,this.r);
ctx.closePath();ctx.fillStyle=this.warm?'#8d6e63':'#7a5230';ctx.fill();
ctx.beginPath();ctx.arc(0,-this.r*1.2,this.r*.55,0,6.283);
ctx.fillStyle='#d7b49e';ctx.fill();ctx.restore();}}
class Spear{constructor(x,y){this.x=x;this.y=y;this.life=0;}
update(dt){this.x+=5*dt*60;this.life+=dt;}
draw(){ctx.strokeStyle='#ffd36e';ctx.lineWidth=3;
ctx.beginPath();ctx.moveTo(this.x-12,this.y);ctx.lineTo(this.x+12,this.y);ctx.stroke();}}
class Bison{constructor(x,y){this.x=x;this.y=y;this.w=46;this.h=28;this.tagged=false;this.speed=0.035;}
rect(){return{x:this.x-this.w/2,y:this.y-this.h/2,w:this.w,h:this.h};}
update(dt){if(this.tagged)return;this.x-=this.speed*dt*60;if(this.x<-60)this.x=canvas.width+60;}
draw(){ctx.fillStyle=this.tagged?'#7cb342':'#5a3d2e';
ctx.fillRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h);}}
class Pickup{constructor(x,y,type){this.x=x;this.y=y;this.type=type;this.remove=false;}
rect(){return{x:this.x-12,y:this.y-12,w:24,h:24};}
draw(){ctx.fillStyle=this.type==='stone'?'#9aa4a9':this.type==='wood'?'#8b5a3c':'#b1c94a';
ctx.beginPath();ctx.arc(this.x,this.y,10,0,6.283);ctx.fill();}}

function initLevel(){player=new Player();spears=[];herd=[];pickups=[];
res={meat:0,stone:0,wood:0,fiber:0};time=90;
for(let i=0;i<3;i++)herd.push(new Bison(500+Math.random()*300,300+Math.random()*100));
for(let i=0;i<4;i++)pickups.push(new Pickup(200+Math.random()*500,300+Math.random()*150,'stone'));
for(let i=0;i<4;i++)pickups.push(new Pickup(200+Math.random()*500,300+Math.random()*150,'wood'));
for(let i=0;i<3;i++)pickups.push(new Pickup(200+Math.random()*500,300+Math.random()*150,'fiber'));
ui.levelName.textContent="1/3 — Chasse (glaces)";HUD();drawBG();}
function loop(){
if(!running)return;
const t=performance.now();let dt=(t-last)/16.67;last=t;dt=Math.min(dt,0.5);
const up=keys.has('ArrowUp')||keys.has('KeyZ'),dn=keys.has('ArrowDown')||keys.has('KeyS'),
lf=keys.has('ArrowLeft')||keys.has('KeyQ'),rg=keys.has('ArrowRight')||keys.has('KeyD');
player.vx=(rg?1:0)-(lf?1:0);player.vy=(dn?1:0)-(up?1:0);player.update(dt);
herd.forEach(b=>b.update(dt));spears.forEach(s=>s.update(dt));
for(const s of spears){for(const b of herd){if(!b.tagged&&
s.x<b.x+b.w&&s.x+20>b.x&&s.y<b.y+b.h&&s.y+6>b.y){b.tagged=true;res.meat++;player.hides++;}}}
spears=spears.filter(s=>s.life<3&&s.x<canvas.width+20);
for(const p of pickups){if(!p.remove&&player.x>p.x-16&&player.x<p.x+16&&player.y>p.y-16&&player.y<p.y+16){p.remove=true;res[p.type]++;}}
pickups=pickups.filter(p=>!p.remove);
time-=dt/60;if(time<=0){checkEnd();return;}
drawBG();pickups.forEach(p=>p.draw());herd.forEach(b=>b.draw());player.draw();spears.forEach(s=>s.draw());HUD();
requestAnimationFrame(loop);}
function shoot(){if(!running)return;if(player.spears>0&&player.reload===0){spears.push(new Spear(player.x+20,player.y-10));player.spears--;player.reload=0.5;HUD();}}
function clothes(){if(player.hides>=2&&res.fiber>=2){player.hides-=2;res.fiber-=2;player.warm=true;toast("Vêtements fabriqués");HUD();}else toast("Ressources insuffisantes");}
function makeSagaies(){if(res.stone>=1&&res.wood>=1){res.stone--;res.wood--;player.spears+=5;toast("+5 sagaies taillées");HUD();}else toast("1 pierre et 1 bois nécessaires");}
function goalsOK(){return res.meat>=2&&res.stone>=2&&res.wood>=2&&player.warm;}
function checkEnd(){running=false;if(goalsOK()){toast("Objectifs atteints !","ok");overlay.classList.add('show');}
else toast("Il manque encore des ressources");}
function startGame(){running=true;last=performance.now();requestAnimationFrame(loop);}

window.addEventListener('keydown',e=>{
if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space'].includes(e.code))e.preventDefault();
if(!running){if(e.code==='Enter'){overlay.classList.remove('show');initLevel();startGame();}}
else{
if(['ArrowUp','KeyZ','ArrowDown','KeyS','ArrowLeft','KeyQ','ArrowRight','KeyD'].includes(e.code))keys.add(e.code);
if(e.code==='Space'||e.code==='KeyJ')shoot();
if(e.code==='KeyC')clothes();
if(e.code==='KeyR')makeSagaies();
}});
window.addEventListener('keyup',e=>keys.delete(e.code));
btnStart.onclick=()=>{overlay.classList.add('show');drawBG();};
btnContinue.onclick=()=>{overlay.classList.remove('show');initLevel();startGame();};
btnPause.onclick=()=>{running=!running;if(running){last=performance.now();requestAnimationFrame(loop);}};
drawBG();
</script>
</body>
</html>
