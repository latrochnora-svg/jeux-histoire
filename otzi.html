<!doctype html>
<html lang="fr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ötzi — test dur (sans cache)</title>
<style>
  html,body{margin:0;height:100%;background:#0e141b;color:#e8eef6;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px}
  canvas{background:#93c5fd;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);width:960px;height:540px;outline:none}
  .hud{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;font-weight:600}
  .kbd{padding:2px 6px;border-radius:6px;background:#223049;font-family:ui-monospace,Menlo,Consolas,monospace}
  button{padding:10px 14px;border-radius:10px;border:0;background:#1f6feb;color:#fff;font-weight:700;cursor:pointer}
</style>

<div class="wrap">
  <h1>Ötzi — test dur</h1>
  <div class="hud">
    <button id="start">Lancer</button>
  </div>
  <canvas id="game" width="960" height="540"></canvas>
</div>

<script>
(function(){
  // 1) CONTEXTE
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  if(!ctx){ alert("ctx null"); return; }

  // 2) OUTILS
  function rr(x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }

  // 3) FOND (montagnes simplifiées) + panneau
  function drawBG(){
    const W=canvas.width, H=canvas.height;
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle='#a4d2ff'; ctx.fillRect(0,0,H*0.41,H*0.41);
    ctx.fillStyle='#86c06a'; ctx.fillRect(0,H*0.44,W,H);
  }
  function drawNarration(){
    drawBG();
    const W=canvas.width, H=canvas.height;
    ctx.fillStyle='rgba(0,0,0,.65)'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#0b5'; rr(W/2-360,H/2-120,720,200,16); ctx.fill();
    ctx.fillStyle='#111'; rr(W/2-356,H/2-116,712,192,14); ctx.fill();
    ctx.fillStyle='#fff'; ctx.textAlign='center';
    ctx.font='bold 28px system-ui';
    ctx.fillText('Avant le niveau 1 — Les glaces', W/2, H/2-50);
    ctx.font='16px system-ui';
    ctx.fillText('Tu es Ötzi. Le froid est mordant : chasse et protège-toi.', W/2, H/2-10);
    ctx.fillText('Objectifs : nourriture, outils, vêtements (2 peaux + 2 fibres).', W/2, H/2+18);
    // bouton
    ctx.fillStyle='#1f6feb'; rr(W/2-120,H/2+44,240,42,10); ctx.fill();
    ctx.fillStyle='#fff'; ctx.font='bold 16px system-ui';
    ctx.fillText('Commencer (Entrée ou clic)', W/2, H/2+71);
  }

  // 4) DEMARRAGE FORCÉ
  function boot(){
    drawNarration();                   // <- DOIT s’afficher tout de suite
    console.log('BOOT OK');
  }
  window.addEventListener('load', boot);

  // 5) Clic/Entrée pour juste prouver que ça répond
  function start(){
    drawBG();
    ctx.fillStyle='#111'; ctx.font='bold 24px system-ui'; ctx.textAlign='center';
    ctx.fillText('Niveau 1 chargé (test). Ça répond.', canvas.width/2, 40);
    // petit disque qui bouge => preuve d’animation
    let x=40, dir=1;
    function loop(){
      drawBG();
      ctx.fillStyle='#222'; ctx.fillText('Niveau 1 (démo).', canvas.width/2, 40);
      ctx.beginPath(); ctx.arc(x, 400, 20, 0, Math.PI*2); ctx.fillStyle='#7cb342'; ctx.fill();
      x += 3*dir; if(x<40||x>canvas.width-40) dir*=-1;
      requestAnimationFrame(loop);
    }
    loop();
  }
  document.getElementById('start').addEventListener('click', start);
  document.addEventListener('click', start, {once:true});
  document.addEventListener('keydown', (e)=>{ if(e.code==='Enter') start(); }, {once:true});
})();
</script>
</html>
