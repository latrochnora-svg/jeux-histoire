<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ötzi — Des glaces au village </title>
<style>
  html,body{margin:0;height:100%;background:#0f1419;color:#e8eef6;
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{display:flex;flex-direction:column;align-items:center;gap:10px;padding:16px}
  canvas{background:#b7dcff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.35);
  width:960px;height:540px}
  .hud{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;
  font-weight:600}
  .kbd{padding:2px 6px;border-radius:6px;background:#223049;
  font-family:ui-monospace,Menlo,Consolas,monospace}
  button{padding:8px 12px;border-radius:10px;border:0;background:#1f6feb;
  color:#fff;font-weight:700;cursor:pointer}
  button.secondary{background:#2b3950}
  .pill{padding:3px 8px;border-radius:999px;background:#0b5;color:#fff;font-weight:700;font-size:12px}
  .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.65);z-index:10}
  .overlay.show{display:flex}
  .card{max-width:760px;background:#161e27;padding:22px;border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.5)}
  h1,h2{margin:0 0 10px}
  .toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
  background:#1f2530;color:#fff;padding:10px 14px;border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.4);font-weight:600;display:none;z-index:15}
  .toast.show{display:block}
</style>
</head>

<body>
<div class="wrap">
  <h1>Ötzi — version sagaies (classe)</h1>
  <div class="hud">
    <span>Niveau: <b id="levelName">—</b></span>
    <span>Temps: <b id="time">—</b>s</span>
    <span>Nourriture: <b id="meat">0</b></span>
    <span>Peaux: <b id="hides">0</b></span>
    <span>Pierre: <b id="stone">0</b></span>
    <span>Bois: <b id="wood">0</b></span>
    <span>Fibres: <b id="fiber">0</b></span>
    <span>Objets: <b id="crafted">0</b></span>
    <span>Bétail: <b id="livestock">0</b></span>
    <span>Sagaies: <b id="spears">50</b></span>
    <span>Vies: <b id="lives">3</b></span>
    <button id="btnStart"  type="button">Lancer / Rejouer</button>
    <button id="btnPause"  type="button" class="secondary">P: Pause</button>
  </div>
  <div>Commandes : <span class="kbd">← → ↑ ↓</span> / <span class="kbd">Z Q S D</span> • <span class="kbd">Espace</span>/<span class="kbd">J</span> lancer une sagaie • <span class="kbd">C</span> vêtements • <span class="kbd">R</span> tailler des sagaies • <span class="kbd">Entrée</span> continuer.</div>
  <canvas id="game" width="960" height="540"></canvas>
  <div style="max-width:960px;text-align:center">
    Étapes : <span class="pill">1. Chasse</span> → <span class="pill">2. Élevage</span> → <span class="pill">3. Artisanat</span>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
const UI=id=>document.getElementById(id);
const ui={levelName:UI('levelName'),time:UI('time'),meat:UI('meat'),
hides:UI('hides'),stone:UI('stone'),wood:UI('wood'),fiber:UI('fiber'),
crafted:UI('crafted'),livestock:UI('livestock'),spears:UI('spears'),
lives:UI('lives')};
const btnStart=document.getElementById('btnStart'),btnPause=document.getElementById('btnPause'),
toastEl=document.getElementById('toast');

function toast(msg,kind='warn',ms=1500){toastEl.textContent=msg;
toastEl.className='toast show '+kind;setTimeout(()=>toastEl.className='toast',ms);}

const LVL=[{
  name:"1/3 — Chasse (glaces)",time:90,herd:3,bisonSpeed:0.05,
  stones:4,woods:4,fibers:3,
  goals:{meat:2,stone:2,wood:2,clothes:true}
},
{
  name:"2/3 — Élevage",time:90,herd:0,stones:2,woods:3,fibers:2,
  goals:{meat:0,stone:2,wood:3,clothes:true,livestock:2}
}];

class Player{constructor(){this.x=120;this.y=440;this.r=16;this.vx=0;this.vy=0;this.s=2.2;this.spears=50;this.reload=0;this.hides=0;this.warm=false;}
rect(){return{x:this.x-16,y:this.y-16,w:32,h:32};}
update(dt){this.x=Math.max(16,Math.min(canvas.width-16,this.x+this.vx*this.s*dt));
this.y=Math.max(220,Math.min(canvas.height-16,this.y+this.vy*this.s*dt));
this.reload=Math.max(0,this.reload-dt);}
draw(){ctx.save();ctx.translate(this.x,this.y);
ctx.globalAlpha=.25;ctx.beginPath();ctx.ellipse(0,this.r,this.r*.9,this.r*.4,0,0,6.283);
ctx.fillStyle='#1b2a3b';ctx.fill();ctx.globalAlpha=1;
ctx.beginPath();ctx.moveTo(0,-this.r);ctx.lineTo(this.r*.9,this.r);
ctx.lineTo(-this.r*.9,this.r);ctx.closePath();ctx.fillStyle=this.warm?'#8d6e63':'#7a5230';
ctx.fill();ctx.beginPath();ctx.arc(0,-this.r*1.2,this.r*.55,0,6.283);
ctx.fillStyle='#d7b49e';ctx.fill();ctx.restore();}}
class Spear{constructor(x,y){this.x=x;this.y=y;this.life=0;}
update(dt){this.x+=5*dt*60;this.life+=dt;}
draw(){ctx.strokeStyle='#ffd36e';ctx.lineWidth=3;
ctx.beginPath();ctx.moveTo(this.x-12,this.y);ctx.lineTo(this.x+12,this.y);ctx.stroke();}}
class Bison{constructor(x,y){this.x=x;this.y=y;this.w=46;this.h=28;this.tagged=false;this.speed=0.05;}
rect(){return{x:this.x-this.w/2,y:this.y-this.h/2,w:this.w,h:this.h};}
update(dt){if(this.tagged)return;this.x-=this.speed*dt*60;if(this.x<-60)this.x=canvas.width+60;}
draw(){ctx.fillStyle=this.tagged?'#7cb342':'#5a3d2e';ctx.fillRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h);}}
class Pickup{constructor(x,y,type){this.x=x;this.y=y;this.type=type;this.remove=false;}
rect(){return{x:this.x-12,y:this.y-12,w:24,h:24};}
draw(){ctx.fillStyle=this.type==='stone'?'#9aa4a9':this.type==='wood'?'#8b5a3c':'#b1c94a';
ctx.beginPath();ctx.arc(this.x,this.y,10,0,6.283);ctx.fill();}}

let running=false,last=performance.now(),keys=new Set();
let lvl=0,level=null,time=0,player=null,spears=[],herd=[],pickups=[],res=null;

function drawBG(){ctx.fillStyle='#b7dcff';ctx.fillRect(0,0,canvas.width,220);
ctx.fillStyle='#8cc58a';ctx.fillRect(0,240,canvas.width,canvas.height-240);}
function HUD(){ui.time.textContent=Math.max(0,Math.ceil(time));
ui.meat.textContent=res.meat;ui.hides.textContent=player.hides;
ui.stone.textContent=res.stone;ui.wood.textContent=res.wood;
ui.fiber.textContent=res.fiber;ui.spears.textContent=player.spears;}
function initLevel(i){
lvl=i;level=LVL[i];time=level.time;player=new Player();
spears=[];herd=[];pickups=[];res={meat:0,stone:0,wood:0,fiber:0,livestock:0};
for(let k=0;k<level.herd;k++){const x=540+Math.random()*(canvas.width-560);
const y=300+Math.random()*160;herd.push(new Bison(x,y));}
const add=(n,t)=>{for(let k=0;k<n;k++)pickups.push(new Pickup(60+Math.random()*(canvas.width-120),280+Math.random()*(canvas.height-340),t));};
add(level.stones,'stone');add(level.woods,'wood');add(level.fibers,'fiber');
ui.levelName.textContent=level.name;HUD();drawBG();}

function loop(){
if(!running)return;
const t=performance.now();let dt=(t-last)/16.67;last=t;dt=Math.min(dt,0.5);
const up=keys.has('ArrowUp')||keys.has('KeyZ'),dn=keys.has('ArrowDown')||keys.has('KeyS'),
lf=keys.has('ArrowLeft')||keys.has('KeyQ'),rg=keys.has('ArrowRight')||keys.has('KeyD');
player.vx=(rg?1:0)-(lf?1:0);player.vy=(dn?1:0)-(up?1:0);player.update(dt);
herd.forEach(b=>b.update(dt));spears.forEach(s=>s.update(dt));
for(const s of spears){for(const b of herd){if(!b.tagged&&
s.x<b.x+b.w&&s.x+20>b.x&&s.y<b.y+b.h&&s
