<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ötzi – Start Fix</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0e141b; color:#e8eef6; }
    .wrap { display:flex; flex-direction:column; align-items:center; gap:12px; padding:18px; }
    canvas { background:#93c5fd; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); width: min(980px, 95vw); height: calc(min(980px, 95vw) * 0.56); image-rendering: pixelated; }
    .hud { display:flex; gap:16px; flex-wrap:wrap; align-items:center; justify-content:center; font-weight:600; }
    .btns { display:flex; gap:8px; flex-wrap:wrap; }
    button { padding:10px 14px; border-radius:10px; border:0; background:#1f6feb; color:white; font-weight:700; cursor:pointer; box-shadow: 0 4px 14px rgba(31,111,235,.35);} 
    button.secondary{ background:#2b3950; }
    .kbd { padding:2px 6px; border-radius:6px; background:#223049; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Ötzi – Test & correctif de démarrage</h1>
    <div class="hud">
      <button id="startBtn">Lancer / Rejouer</button>
      <button id="pauseBtn" class="secondary">Pause</button>
    </div>
    <canvas id="game" width="960" height="540"></canvas>
    <div>Contrôles : <span class="kbd">← → ↑ ↓</span> ou <span class="kbd">W A S D</span> • <span class="kbd">Espace</span> lance.</div>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let running=false, last=performance.now();
const player = { x: 200, y: 380, r: 16, vx:0, vy:0, speed: 3 };
const keys = new Set();

function resize(){
  const rect = canvas.getBoundingClientRect();
  const ratio = window.devicePixelRatio || 1;
  canvas.width = Math.round(rect.width * ratio);
  canvas.height = Math.round(rect.height * ratio);
}
new ResizeObserver(resize).observe(canvas);
resize(); // IMPORTANT : premier appel immédiat

// Empêcher la page de capter les flèches (scroll)
addEventListener('keydown', (e)=>{
  if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space'].includes(e.code)) e.preventDefault();
  keys.add(e.code);
});
addEventListener('keyup', (e)=> keys.delete(e.code));

document.getElementById('startBtn').addEventListener('click', ()=>{ running=true; last=performance.now(); loop(); info("Démarré : appuie sur les flèches/WASD."); });
document.getElementById('pauseBtn').addEventListener('click', ()=>{ running=!running; if(running){ last=performance.now(); loop(); } });

function loop(){
  if(!running) return;
  const t=performance.now(), dt=(t-last)/16.67; last=t;
  // input
  const up=keys.has('ArrowUp')||keys.has('KeyW');
  const down=keys.has('ArrowDown')||keys.has('KeyS');
  const left=keys.has('ArrowLeft')||keys.has('KeyA');
  const right=keys.has('ArrowRight')||keys.has('KeyD');
  player.vx = (right?1:0) - (left?1:0);
  player.vy = (down?1:0) - (up?1:0);
  player.x += player.vx * player.speed * dt;
  player.y += player.vy * player.speed * dt;
  player.x = Math.max(player.r, Math.min(canvas.width-player.r, player.x));
  player.y = Math.max(220, Math.min(canvas.height-player.r, player.y));
  // draw
  ctx.fillStyle = '#a4d2ff'; ctx.fillRect(0,0,canvas.width,240);
  ctx.fillStyle = '#86c06a'; ctx.fillRect(0,240,canvas.width,canvas.height-240);
  drawPlayer();
  requestAnimationFrame(loop);
}

function drawPlayer(){
  ctx.save(); ctx.translate(player.x, player.y);
  ctx.globalAlpha=.25; ctx.beginPath(); ctx.ellipse(0, player.r, player.r*.9, player.r*.4, 0, 0, Math.PI*2); ctx.fillStyle='#1b2a3b'; ctx.fill(); ctx.globalAlpha=1;
  ctx.beginPath(); ctx.moveTo(0,-player.r); ctx.lineTo(player.r*.9,player.r); ctx.lineTo(-player.r*.9,player.r); ctx.closePath();
  ctx.fillStyle='#7a5230'; ctx.fill();
  ctx.beginPath(); ctx.arc(0,-player.r*1.2, player.r*.55, 0, Math.PI*2); ctx.fillStyle = '#d7b49e'; ctx.fill();
  ctx.restore();
}

function info(text){
  ctx.save();
  ctx.fillStyle='rgba(0,0,0,.6)';
  ctx.fillRect(10,10, canvas.width-20, 40);
  ctx.fillStyle='white';
  ctx.font='16px system-ui';
  ctx.textAlign='center';
  ctx.fillText(text, canvas.width/2, 36);
  ctx.restore();
}

// Message initial
info("Clique sur Lancer puis bouge avec les flèches/WASD. Si rien ne bouge, vérifie que la page n'est pas en train de défiler.");
</script>
</body>
</html>
